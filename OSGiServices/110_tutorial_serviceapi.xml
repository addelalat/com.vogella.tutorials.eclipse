<section id="osgiservice_tutorial">
	<title>Tutorial: Using the OSGi service API</title>
	<para>
		In the following we will
		define and
		consume a service. Our service
		will
		return "famous quotes".
	</para>
	<section id="osgiservice_interface">
		<title>Define the service interface</title>
		<para>
			Create a plug-in project "de.vogella.osgi.quote" and the package
			"de.vogella.osgi.quote". Do not use a
			template. You do not need an
			activator. Afterwards select the MANIFEST.MF and the
			<guilabel>Runtime</guilabel>
			tab.
			Add
			"de.vogella.osgi.quote" to the exported packages.
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/firstservice10.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para>Create the following interface "IQuoteService".</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/service/IQuoteService.java" />
			</programlisting>
		</para>
	</section>
	<section id="osgiservice_service">
		<title>Create service</title>
		<para> We will now define a bundle which will provide the service.
		</para>
		<para> Create a plug-in project "de.vogella.osgi.quoteservice". Do not
			use a template.
		</para>
		<para> Select the MANIFEST.MF and dependecy tab. Add
			"de.vogella.osgi.quote" to the required plugins.
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/firstservice20.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para> Create the following class "QuoteService".</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/service/QuoteService.java" />
			</programlisting>
		</para>
		<para> Register the service in the class Activator.</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/service/ActivatorService.java" />
			</programlisting>
		</para>
	</section>
	<section id="osgiservice_server">
		<title>Install service bundles</title>
		<para> Export your bundles and install them on your server. Start the
			service bundle.
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/firstservice30.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para>
			<tip>Nothing fancy happens, as we are not yet consuming our
				service.
			</tip>
		</para>
	</section>
	<section id="osgiservice_useservice">
		<title>Use your service</title>
		<para>Create a new plug-in "de.vogella.osgi.quoteconsumer". Add
			also a
			dependency to the package "de.vogella.osgi.quote".
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/firstservice35.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para>
			<tip> Please note that we have added the dependency against the
				package NOT against the plugin. This way we later replace the
				service with a different implementation.
			</tip>
		</para>
		<para> Lets register directly to the service and use it.</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/service/ActivatorConsument.java" />
			</programlisting>
		</para>
		<para>Export this bundle, install it and start and stop it.
			Everything
			work. But if you stop the service bundle then your receive
			an error.
		</para>
		<para>
			<mediaobject>
				<imageobject>
					<imagedata fileref="images/firstservice40.gif" />

				</imageobject>
			</mediaobject>
		</para>
		<para> The reason for this is that OSGi is a very dynamic environment
			and service may be registered and de-registered any time. The next
			chapter will use a service tracker to improve this.
		</para>
	</section>
	<section id="osgiservice_servicetracker">
		<title>Use your service with a service tracker</title>
		<para> Declare a package dependency to the package
			"org.osgi.util.tracker" in your bundle.
		</para>
		<para> To use this define the following class
			"MyQuoteServiceTrackerCustomizer"
		</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/service/MyQuoteServiceTrackerCustomizer.java" />
			</programlisting>
		</para>
		<para> You also need to register a service tracker in your activator
			of your serviceconsumer.
		</para>
		<para>
			<programlisting>
				<xi:include xmlns:xi="http://www.w3.org/2001/XInclude"
					parse="text" href="./examples/service/ActivatorServiceTracker.java" />
			</programlisting>
		</para>
		<para> Export your bundle again. Start the OSGi console. Use the
			update command or the install command to get the new version of your
			bundle and start it. Once you start your service the tracker will be
			called and the consumer bundle will start writing messages to the
			console. Stop the service and verify that the consumer does not use
			the service anymore.
		</para>
	</section>

</section>